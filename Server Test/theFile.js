var formular=document.querySelector('form');formular.addEventListener('submit',async(e)=>{e.preventDefault();var key=await generateAESKey();var iv=window.crypto.getRandomValues(new Uint8Array(16));JSONresult={"userData":{},"ownerData":{}};var encrdata=await encryptOwnerData("{\"alg\":\"RSA-OAEP-256\",\"e\":\"AQAB\",\"ext\":true,\"key_ops\":[\"encrypt\",\"wrapKey\"],\"kty\":\"RSA\",\"n\":\"9l_1qm9A4B3_c1T5IGcmoLIPImEsCSZSmQycrNrt554lQUgYqB2FTdI-c0AWY8ElAwB6Y8oKqf2kgYQ3HeusDJqPSPe8_cB8ILMbNw-lbqWvmQg7DgQ7AIUJ9JFlVJjweRcqwBoODcaD6NOPSu0lNFXJs-XaoNGdQirXz1Ig-0RW_gWWc3ay9HqS-G8tTuWk4s1vIoVq2Ny0RNcJ2KWwR7SB4N2IChHrhlcxV3Jwthnvndq0GqBS_QjENLg1PmbKoO2eP3VSsUOlbZjAqpWY7xSgcdacTO0caIgXLPYwpz2Di3eLEtvza_LtHyeae5a3n7WDKTkmwzATIEDGuIsPHw\"}",iv,key);var encryptedUID={"0":102,"1":90,"2":21,"3":154,"4":186,"5":3,"6":5,"7":60,"8":98,"9":44,"10":123,"11":214,"12":76,"13":67,"14":162,"15":121,"16":124,"17":14,"18":24,"19":244,"20":118,"21":59,"22":45,"23":208,"24":241,"25":189,"26":221,"27":95,"28":254,"29":151,"30":230,"31":225,"32":38,"33":181,"34":245,"35":127,"36":85,"37":220,"38":162,"39":197,"40":96,"41":84,"42":75,"43":186,"44":104,"45":244,"46":39,"47":254,"48":122,"49":115,"50":108,"51":31,"52":63,"53":23,"54":223,"55":93,"56":55,"57":27,"58":154,"59":37,"60":129,"61":220,"62":108,"63":35,"64":69,"65":125,"66":129,"67":49,"68":113,"69":212,"70":228,"71":20,"72":68,"73":144,"74":70,"75":236,"76":107,"77":202,"78":50,"79":51,"80":51,"81":59,"82":200,"83":54,"84":43,"85":77,"86":242,"87":202,"88":166,"89":138,"90":111,"91":69,"92":49,"93":140,"94":19,"95":60,"96":220,"97":217,"98":3,"99":225,"100":205,"101":228,"102":234,"103":220,"104":234,"105":211,"106":35,"107":63,"108":185,"109":68,"110":91,"111":217,"112":5,"113":228,"114":101,"115":130,"116":240,"117":48,"118":126,"119":25,"120":129,"121":134,"122":247,"123":239,"124":24,"125":78,"126":158,"127":149};JSONresult.userData.aesComponents=encrdata;JSONresult.ownerData.uid=uidJsonToArray(encryptedUID);var siteName="jetix.ro";siteName=siteName.replace('.','_');JSONresult.ownerData.siteName=siteName
var data=new FormData(e.target);for(var pair of data.entries()){JSONresult.userData[pair[0]]=await encryptUserData(pair[1],key,iv)}
JSONresult.userTimestamp=+new Date();console.log(JSONresult);fetch("http://localhost:5016",{method:"POST",headers:{"Content-Type":"text/plain",},mode:"no-cors",body:JSON.stringify(JSONresult)}).then(function(response){formular.submit()})});async function generateAESKey(){var AESkey;await window.crypto.subtle.generateKey({name:"AES-CTR",length:128,},!0,["encrypt","decrypt"]).then(function(result){AESkey=result});return AESkey}
async function encryptOwnerData(RSAPublicKey,iv,keyToEncrypt){ownerJson={};var algorithm={name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([0x01,0x00,0x01]),hash:{name:"SHA-256"},};RSAPublicKey=await JSON.parse(RSAPublicKey);await window.crypto.subtle.importKey("jwk",RSAPublicKey,algorithm,!0,["encrypt","wrapKey"]).then((key)=>{RSAPublicKey=key}).catch(e=>console.log(e.message));await window.crypto.subtle.encrypt(algorithm,RSAPublicKey,iv).then(function(encrypted){ownerJson.iv=new Uint8Array(encrypted)}).catch(e=>console.log(e.message));await window.crypto.subtle.wrapKey("raw",keyToEncrypt,RSAPublicKey,algorithm).then(function(wrapped){ownerJson.key=new Uint8Array(wrapped)}).catch(e=>console.log(e.message));return ownerJson}
async function encryptUserData(data,key,iv){var encryptedData;var enc=new TextEncoder();await window.crypto.subtle.encrypt({name:"AES-CTR",counter:iv,length:128,},key,enc.encode(data)).then(function(encrypted){encryptedData=new Uint8Array(encrypted);console.log(encryptedData)});return encryptedData}
function uidJsonToArray(json){var ret=new Uint8Array(128);for(var i=0;i<128;i++){ret[i]=json[i]}
return ret}